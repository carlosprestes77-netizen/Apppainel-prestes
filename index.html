import { useState, useEffect } from "react";
import { BrowserRouter as Router, Routes, Route, Link } from "react-router-dom";

function App() {
  const [theme, setTheme] = useState("light");

  // Eventos
  const [events, setEvents] = useState([]);
  const [eventForm, setEventForm] = useState({
    nome: "",
    data: "",
    valor: "",
    pago: false,
  });

  // D√≠vidas
  const [debts, setDebts] = useState([]);
  const [debtForm, setDebtForm] = useState({
    descricao: "",
    vencimento: "",
    valor: "",
    pago: false,
  });

  // Carregar dados
  useEffect(() => {
    const t = localStorage.getItem("theme");
    const ev = localStorage.getItem("events");
    const de = localStorage.getItem("debts");

    if (t) setTheme(t);
    if (ev) setEvents(JSON.parse(ev));
    if (de) setDebts(JSON.parse(de));
  }, []);

  // Salvar dados
  useEffect(() => {
    localStorage.setItem("theme", theme);
  }, [theme]);

  useEffect(() => {
    localStorage.setItem("events", JSON.stringify(events));
  }, [events]);

  useEffect(() => {
    localStorage.setItem("debts", JSON.stringify(debts));
  }, [debts]);

  const toggleTheme = () => {
    setTheme((prev) => (prev === "light" ? "dark" : "light"));
  };

  // Add event
  const addEvent = (e) => {
    e.preventDefault();
    if (!eventForm.nome || !eventForm.data || !eventForm.valor) return;

    setEvents((prev) => [
      ...prev,
      {
        id: Date.now(),
        nome: eventForm.nome,
        data: eventForm.data,
        valor: Number(eventForm.valor),
        pago: eventForm.pago,
      },
    ]);

    setEventForm({ nome: "", data: "", valor: "", pago: false });
  };

  // Add debt
  const addDebt = (e) => {
    e.preventDefault();
    if (!debtForm.descricao || !debtForm.vencimento || !debtForm.valor) return;

    setDebts((prev) => [
      ...prev,
      {
        id: Date.now(),
        descricao: debtForm.descricao,
        vencimento: debtForm.vencimento,
        valor: Number(debtForm.valor),
        pago: debtForm.pago,
      },
    ]);

    setDebtForm({ descricao: "", vencimento: "", valor: "", pago: false });
  };

  // Toggle pago
  const toggleEventPaid = (id) => {
    setEvents((prev) =>
      prev.map((ev) =>
        ev.id === id ? { ...ev, pago: !ev.pago } : ev
      )
    );
  };

  const toggleDebtPaid = (id) => {
    setDebts((prev) =>
      prev.map((d) =>
        d.id === id ? { ...d, pago: !d.pago } : d
      )
    );
  };

  const downloadBackup = () => {
    const data = JSON.stringify(
      { theme, events, debts },
      null,
      2
    );

    const blob = new Blob([data], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "backup-financas.json";
    a.click();

    URL.revokeObjectURL(url);
  };

  const importBackup = (e) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const json = JSON.parse(event.target.result);
        if (json.theme) setTheme(json.theme);
        if (json.events) setEvents(json.events);
        if (json.debts) setDebts(json.debts);
      } catch {
        alert("Arquivo inv√°lido.");
      }
    };
    reader.readAsText(file);
  };

  return (
    <Router>
      <div className={`app ${theme}`}>
        <aside className="sidebar">
          <h2>Painel</h2>
          <nav>
            <Link to="/">Dashboard</Link>
            <Link to="/eventos">Eventos</Link>
            <Link to="/dividas">D√≠vidas</Link>
          </nav>

          <button onClick={toggleTheme} className="theme-btn">
            {theme === "light" ? "üåô Modo Noite" : "‚òÄÔ∏è Modo Claro"}
          </button>

          <button onClick={downloadBackup}>üíæ Backup</button>

          <label className="import-label">
            üìÇ Importar
            <input type="file" accept="application/json" onChange={importBackup} />
          </label>

          <button onClick={() => window.print()}>
            üßæ PDF
          </button>
        </aside>

        <main>
          <Routes>
            {/* DASHBOARD */}
            <Route
              path="/"
              element={
                <div className="dashboard">
                  <h1>Dashboard</h1>

                  <div className="cards">
                    <div className="card">
                      <h3>Eventos</h3>
                      <p>Total: R$ {events.reduce((acc, e) => acc + e.valor, 0).toFixed(2)}</p>
                      <p>Pagos: R$ {events.filter(e => e.pago).reduce((acc, e) => acc + e.valor, 0).toFixed(2)}</p>
                      <p>Pendentes: R$ {events.filter(e => !e.pago).reduce((acc, e) => acc + e.valor, 0).toFixed(2)}</p>
                    </div>

                    <div className="card">
                      <h3>D√≠vidas</h3>
                      <p>Total: R$ {debts.reduce((acc, d) => acc + d.valor, 0).toFixed(2)}</p>
                      <p>Pagas: R$ {debts.filter(d => d.pago).reduce((acc, d) => acc + d.valor, 0).toFixed(2)}</p>
                      <p>Abertas: R$ {debts.filter(d => !d.pago).reduce((acc, d) => acc + d.valor, 0).toFixed(2)}</p>
                    </div>
                  </div>
                </div>
              }
            />

            {/* EVENTOS */}
            <Route
              path="/eventos"
              element={
                <div>
                  <h1>Eventos</h1>

                  <form onSubmit={addEvent} className="form">
                    <input
                      type="text"
                      placeholder="Nome"
                      value={eventForm.nome}
                      onChange={(e) => setEventForm({ ...eventForm, nome: e.target.value })}
                    />
                    <input
                      type="date"
                      value={eventForm.data}
                      onChange={(e) => setEventForm({ ...eventForm, data: e.target.value })}
                    />
                    <input
                      type="number"
                      placeholder="Valor"
                      value={eventForm.valor}
                      onChange={(e) => setEventForm({ ...eventForm, valor: e.target.value })}
                    />
                    <label>
                      Pago?
                      <input
                        type="checkbox"
                        checked={eventForm.pago}
                        onChange={(e) => setEventForm({ ...eventForm, pago: e.target.checked })}
                      />
                    </label>
                    <button type="submit">Adicionar</button>
                  </form>

                  <table>
                    <thead>
                      <tr>
                        <th>Data</th>
                        <th>Nome</th>
                        <th>Valor</th>
                        <th>Status</th>
                        <th></th>
                      </tr>
                    </thead>

                    <tbody>
                      {events.map((ev) => (
                        <tr key={ev.id}>
                          <td>{ev.data}</td>
                          <td>{ev.nome}</td>
                          <td>R$ {ev.valor.toFixed(2)}</td>
                          <td>{ev.pago ? "Pago" : "Pendente"}</td>
                          <td>
                            <button onClick={() => toggleEventPaid(ev.id)}>
                              {ev.pago ? "Desmarcar" : "Pagar"}
                            </button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              }
            />

            {/* D√çVIDAS */}
            <Route
              path="/dividas"
              element={
                <div>
                  <h1>D√≠vidas</h1>

                  <form onSubmit={addDebt} className="form">
                    <input
                      type="text"
                      placeholder="Descri√ß√£o"
                      value={debtForm.descricao}
                      onChange={(e) => setDebtForm({ ...debtForm, descricao: e.target.value })}
                    />
                    <input
                      type="date"
                      value={debtForm.vencimento}
                      onChange={(e) => setDebtForm({ ...debtForm, vencimento: e.target.value })}
                    />
                    <input
                      type="number"
                      placeholder="Valor"
                      value={debtForm.valor}
                      onChange={(e) => setDebtForm({ ...debtForm, valor: e.target.value })}
                    />
                    <label>
                      Pago?
                      <input
                        type="checkbox"
                        checked={debtForm.pago}
                        onChange={(e) => setDebtForm({ ...debtForm, pago: e.target.checked })}
                      />
                    </label>
                    <button type="submit">Adicionar</button>
                  </form>

                  <table>
                    <thead>
                      <tr>
                        <th>Vencimento</th>
                        <th>Descri√ß√£o</th>
                        <th>Valor</th>
                        <th>Status</th>
                        <th></th>
                      </tr>
                    </thead>

                    <tbody>
                      {debts.map((d) => (
                        <tr key={d.id}>
                          <td>{d.vencimento}</td>
                          <td>{d.descricao}</td>
                          <td>R$ {d.valor.toFixed(2)}</td>
                          <td>{d.pago ? "Paga" : "Aberta"}</td>
                          <td>
                            <button onClick={() => toggleDebtPaid(d.id)}>
                              {d.pago ? "Desmarcar" : "Pagar"}
                            </button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              }
            />
          </Routes>
        </main>
      </div>
    </Router>
  );
}

export default App;
              import { useState, useEffect } from "react";
import { BrowserRouter as Router, Routes, Route, Link } from "react-router-dom";

function getMonthKey(dateStr) {
  if (!dateStr) return "";
  return dateStr.slice(0, 7); // YYYY-MM
}

function App() {
  const [theme, setTheme] = useState("light");

  // Eventos
  const [events, setEvents] = useState([]);
  const [eventForm, setEventForm] = useState({
    nome: "",
    data: "",
    valor: "",
    pago: false,
  });

  // D√≠vidas
  const [debts, setDebts] = useState([]);
  const [debtForm, setDebtForm] = useState({
    descricao: "",
    vencimento: "",
    valor: "",
    pago: false,
  });

  // Filtro de m√™s (YYYY-MM ou "all")
  const [selectedMonth, setSelectedMonth] = useState("all");

  // Carregar dados
  useEffect(() => {
    const t = localStorage.getItem("theme");
    const ev = localStorage.getItem("events");
    const de = localStorage.getItem("debts");
    const sm = localStorage.getItem("selectedMonth");

    if (t) setTheme(t);
    if (ev) setEvents(JSON.parse(ev));
    if (de) setDebts(JSON.parse(de));
    if (sm) setSelectedMonth(sm);
  }, []);

  // Salvar dados
  useEffect(() => {
    localStorage.setItem("theme", theme);
  }, [theme]);

  useEffect(() => {
    localStorage.setItem("events", JSON.stringify(events));
  }, [events]);

  useEffect(() => {
    localStorage.setItem("debts", JSON.stringify(debts));
  }, [debts]);

  useEffect(() => {
    localStorage.setItem("selectedMonth", selectedMonth);
  }, [selectedMonth]);

  const toggleTheme = () => {
    setTheme((prev) => (prev === "light" ? "dark" : "light"));
  };

  // Add event
  const addEvent = (e) => {
    e.preventDefault();
    if (!eventForm.nome || !eventForm.data || !eventForm.valor) return;

    setEvents((prev) => [
      ...prev,
      {
        id: Date.now(),
        nome: eventForm.nome,
        data: eventForm.data,
        valor: Number(eventForm.valor),
        pago: eventForm.pago,
      },
    ]);

    setEventForm({ nome: "", data: "", valor: "", pago: false });
  };

  // Add debt
  const addDebt = (e) => {
    e.preventDefault();
    if (!debtForm.descricao || !debtForm.vencimento || !debtForm.valor) return;

    setDebts((prev) => [
      ...prev,
      {
        id: Date.now(),
        descricao: debtForm.descricao,
        vencimento: debtForm.vencimento,
        valor: Number(debtForm.valor),
        pago: debtForm.pago,
      },
    ]);

    setDebtForm({ descricao: "", vencimento: "", valor: "", pago: false });
  };

  // Toggle pago
  const toggleEventPaid = (id) => {
    setEvents((prev) =>
      prev.map((ev) =>
        ev.id === id ? { ...ev, pago: !ev.pago } : ev
      )
    );
  };

  const toggleDebtPaid = (id) => {
    setDebts((prev) =>
      prev.map((d) =>
        d.id === id ? { ...d, pago: !d.pago } : d
      )
    );
  };

  const downloadBackup = () => {
    const data = JSON.stringify(
      { theme, events, debts, selectedMonth },
      null,
      2
    );

    const blob = new Blob([data], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "backup-financas.json";
    a.click();

    URL.revokeObjectURL(url);
  };

  const importBackup = (e) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const json = JSON.parse(event.target.result);
        if (json.theme) setTheme(json.theme);
        if (json.events) setEvents(json.events);
        if (json.debts) setDebts(json.debts);
        if (json.selectedMonth) setSelectedMonth(json.selectedMonth);
      } catch {
        alert("Arquivo inv√°lido.");
      }
    };
    reader.readAsText(file);
  };

  // Meses existentes
  const monthKeys = Array.from(
    new Set(
      [
        ...events.map((e) => getMonthKey(e.data)),
        ...debts.map((d) => getMonthKey(d.vencimento)),
      ].filter(Boolean)
    )
  ).sort();

  // Filtrados pelo m√™s
  const filteredEvents =
    selectedMonth === "all"
      ? events
      : events.filter((e) => getMonthKey(e.data) === selectedMonth);

  const filteredDebts =
    selectedMonth === "all"
      ? debts
      : debts.filter((d) => getMonthKey(d.vencimento) === selectedMonth);

  // Totais (filtrados)
  const totalEventos = filteredEvents.reduce((acc, e) => acc + e.valor, 0);
  const totalEventosPagos = filteredEvents
    .filter((e) => e.pago)
    .reduce((acc, e) => acc + e.valor, 0);
  const totalEventosPendentes = totalEventos - totalEventosPagos;

  const totalDividas = filteredDebts.reduce((acc, d) => acc + d.valor, 0);
  const totalDividasPagas = filteredDebts
    .filter((d) => d.pago)
    .reduce((acc, d) => acc + d.valor, 0);
  const totalDividasAbertas = totalDividas - totalDividasPagas;

  // "Gr√°fico" simples Entradas x Sa√≠das
  const entradas = totalEventosPagos; // dinheiro que entrou
  const saidas = totalDividasPagas;   // dinheiro que saiu (j√° pago)
  const maxValor = Math.max(entradas, saidas, 1);
  const pctEntradas = (entradas / maxValor) * 100;
  const pctSaidas = (saidas / maxValor) * 100;

  const handlePrint = () => {
    window.print();
  };

  return (
    <Router>
      <div className={`app ${theme}`}>
        <aside className="sidebar">
          <h2>Painel</h2>
          <nav>
            <Link to="/">Dashboard</Link>
            <Link to="/eventos">Eventos</Link>
            <Link to="/dividas">D√≠vidas</Link>
            <Link to="/relatorios">Relat√≥rios</Link>
          </nav>

          <button onClick={toggleTheme} className="theme-btn">
            {theme === "light" ? "üåô Modo Noite" : "‚òÄÔ∏è Modo Claro"}
          </button>

          <button onClick={downloadBackup}>üíæ Backup</button>

          <label className="import-label">
            üìÇ Importar
            <input type="file" accept="application/json" onChange={importBackup} />
          </label>

          <button onClick={handlePrint}>üßæ PDF</button>
        </aside>

        <main>
          <div className="filter-bar">
            <label>
              M√™s:
              <select
                value={selectedMonth}
                onChange={(e) => setSelectedMonth(e.target.value)}
              >
                <option value="all">Todos</option>
                {monthKeys.map((m) => (
                  <option key={m} value={m}>
                    {m}
                  </option>
                ))}
              </select>
            </label>
          </div>

          <Routes>
            {/* DASHBOARD */}
            <Route
              path="/"
              element={
                <div className="dashboard">
                  <h1>Dashboard</h1>

                  <div className="cards">
                    <div className="card">
                      <h3>Eventos</h3>
                      <p>
                        Total: R$ {totalEventos.toFixed(2)}
                      </p>
                      <p>
                        Pagos: R$ {totalEventosPagos.toFixed(2)}
                      </p>
                      <p>
                        Pendentes: R$ {totalEventosPendentes.toFixed(2)}
                      </p>
                    </div>

                    <div className="card">
                      <h3>D√≠vidas</h3>
                      <p>
                        Total: R$ {totalDividas.toFixed(2)}
                      </p>
                      <p>
                        Pagas: R$ {totalDividasPagas.toFixed(2)}
                      </p>
                      <p>
                        Abertas: R$ {totalDividasAbertas.toFixed(2)}
                      </p>
                    </div>
                  </div>

                  <div className="chart">
                    <h2>Entradas x Sa√≠das (pagos)</h2>
                    <div className="chart-row">
                      <span className="chart-label">
                        Entradas (eventos pagos): R$ {entradas.toFixed(2)}
                      </span>
                      <div className="chart-track">
                        <div
                          className="chart-bar entradas"
                          style={{ width: `${pctEntradas}%` }}
                        ></div>
                      </div>
                    </div>

                    <div className="chart-row">
                      <span className="chart-label">
                        Sa√≠das (d√≠vidas pagas): R$ {saidas.toFixed(2)}
                      </span>
                      <div className="chart-track">
                        <div
                          className="chart-bar saidas"
                          style={{ width: `${pctSaidas}%` }}
                        ></div>
                      </div>
                    </div>
                  </div>
                </div>
              }
            />

            {/* EVENTOS */}
            <Route
              path="/eventos"
              element={
                <div>
                  <h1>Eventos</h1>

                  <form onSubmit={addEvent} className="form">
                    <input
                      type="text"
                      placeholder="Nome"
                      value={eventForm.nome}
                      onChange={(e) =>
                        setEventForm({ ...eventForm, nome: e.target.value })
                      }
                    />
                    <input
                      type="date"
                      value={eventForm.data}
                      onChange={(e) =>
                        setEventForm({ ...eventForm, data: e.target.value })
                      }
                    />
                    <input
                      type="number"
                      placeholder="Valor"
                      value={eventForm.valor}
                      onChange={(e) =>
                        setEventForm({ ...eventForm, valor: e.target.value })
                      }
                    />
                    <label>
                      Pago?
                      <input
                        type="checkbox"
                        checked={eventForm.pago}
                        onChange={(e) =>
                          setEventForm({
                            ...eventForm,
                            pago: e.target.checked,
                          })
                        }
                      />
                    </label>
                    <button type="submit">Adicionar</button>
                  </form>

                  <table>
                    <thead>
                      <tr>
                        <th>Data</th>
                        <th>Nome</th>
                        <th>Valor</th>
                        <th>Status</th>
                        <th></th>
                      </tr>
                    </thead>

                    <tbody>
                      {filteredEvents.map((ev) => (
                        <tr key={ev.id}>
                          <td>{ev.data}</td>
                          <td>{ev.nome}</td>
                          <td>R$ {ev.valor.toFixed(2)}</td>
                          <td>{ev.pago ? "Pago" : "Pendente"}</td>
                          <td>
                            <button onClick={() => toggleEventPaid(ev.id)}>
                              {ev.pago ? "Desmarcar" : "Pagar"}
                            </button>
                          </td>
                        </tr>
                      ))}
                      {filteredEvents.length === 0 && (
                        <tr>
                          <td colSpan={5} style={{ textAlign: "center", opacity: 0.7 }}>
                            Nenhum evento neste filtro.
                          </td>
                        </tr>
                      )}
                    </tbody>
                  </table>
                </div>
              }
            />

            {/* D√çVIDAS */}
            <Route
              path="/dividas"
              element={
                <div>
                  <h1>D√≠vidas</h1>

                  <form onSubmit={addDebt} className="form">
                    <input
                      type="text"
                      placeholder="Descri√ß√£o"
                      value={debtForm.descricao}
                      onChange={(e) =>
                        setDebtForm({ ...debtForm, descricao: e.target.value })
                      }
                    />
                    <input
                      type="date"
                      value={debtForm.vencimento}
                      onChange={(e) =>
                        setDebtForm({
                          ...debtForm,
                          vencimento: e.target.value,
                        })
                      }
                    />
                    <input
                      type="number"
                      placeholder="Valor"
                      value={debtForm.valor}
                      onChange={(e) =>
                        setDebtForm({ ...debtForm, valor: e.target.value })
                      }
                    />
                    <label>
                      Pago?
                      <input
                        type="checkbox"
                        checked={debtForm.pago}
                        onChange={(e) =>
                          setDebtForm({
                            ...debtForm,
                            pago: e.target.checked,
                          })
                        }
                      />
                    </label>
                    <button type="submit">Adicionar</button>
                  </form>

                  <table>
                    <thead>
                      <tr>
                        <th>Vencimento</th>
                        <th>Descri√ß√£o</th>
                        <th>Valor</th>
                        <th>Status</th>
                        <th></th>
                      </tr>
                    </thead>

                    <tbody>
                      {filteredDebts.map((d) => (
                        <tr key={d.id}>
                          <td>{d.vencimento}</td>
                          <td>{d.descricao}</td>
                          <td>R$ {d.valor.toFixed(2)}</td>
                          <td>{d.pago ? "Paga" : "Aberta"}</td>
                          <td>
                            <button onClick={() => toggleDebtPaid(d.id)}>
                              {d.pago ? "Desmarcar" : "Pagar"}
                            </button>
                          </td>
                        </tr>
                      ))}
                      {filteredDebts.length === 0 && (
                        <tr>
                          <td colSpan={5} style={{ textAlign: "center", opacity: 0.7 }}>
                            Nenhuma d√≠vida neste filtro.
                          </td>
                        </tr>
                      )}
                    </tbody>
                  </table>
                </div>
              }
            />

            {/* RELAT√ìRIOS */}
            <Route
              path="/relatorios"
              element={
                <div>
                  <h1>Relat√≥rios</h1>
                  <p style={{ opacity: 0.8, marginBottom: "8px" }}>
                    Resumo detalhado do m√™s selecionado.
                  </p>

                  <div className="cards">
                    <div className="card">
                      <h3>Resumo financeiro</h3>
                      <p>Eventos pagos: R$ {totalEventosPagos.toFixed(2)}</p>
                      <p>D√≠vidas pagas: R$ {totalDividasPagas.toFixed(2)}</p>
                      <p>
                        Saldo (entradas - sa√≠das):{" "}
                        <strong>
                          R$ {(totalEventosPagos - totalDividasPagas).toFixed(2)}
                        </strong>
                      </p>
                    </div>

                    <div className="card">
                      <h3>Contagem</h3>
                      <p>Eventos no m√™s: {filteredEvents.length}</p>
                      <p>D√≠vidas no m√™s: {filteredDebts.length}</p>
                      <p>
                        Pagos (somando ambos):{" "}
                        {
                          filteredEvents.filter((e) => e.pago).length +
                          filteredDebts.filter((d) => d.pago).length
                        }
                      </p>
                    </div>
                  </div>
                </div>
              }
            />
          </Routes>
        </main>
      </div>
    </Router>
  );
}

export default App;
.filter-bar {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 16px;
  gap: 8px;
  font-size: 0.9rem;
}

.filter-bar label {
  display: flex;
  align-items: center;
  gap: 6px;
}

.filter-bar select {
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid #d1d5db;
  background: #f9fafb;
}

.app.dark .filter-bar select {
  background: #020617;
  border-color: #1f2937;
  color: #e5e7eb;
}

.chart {
  margin-top: 24px;
  padding: 16px;
  border-radius: 16px;
  background: rgba(196, 165, 245, 0.14);
}

.app.dark .chart {
  background: rgba(148, 163, 184, 0.18);
}

.chart-row {
  margin-top: 10px;
}

.chart-label {
  font-size: 0.85rem;
  display: block;
  margin-bottom: 4px;
}

.chart-track {
  width: 100%;
  height: 10px;
  border-radius: 999px;
  background: rgba(148, 163, 184, 0.35);
  overflow: hidden;
}

.chart-bar {
  height: 100%;
}

.chart-bar.entradas {
  background: #16a34a;
}

.chart-bar.saidas {
  background: #ef4444;
}

              
