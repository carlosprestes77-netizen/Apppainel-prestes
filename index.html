<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel Financeiro ‚Äì Prestes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-pill: 999px;

      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.35);
      --shadow-subtle: 0 1px 4px rgba(15, 23, 42, 0.12);
      --transition-fast: 0.18s ease-out;
      /* ===== MODAL ===== */

.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9000;
}
/* ===== MODAL ===== */

.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9000;
}

.modal-box {
  background: var(--bg-elevated);
  padding: 22px;
  border-radius: 18px;
  width: min(92%, 420px);
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 40px rgba(0,0,0,0.4);
  animation: modalFade .25s ease-out;
  position: relative;
  border: 1px solid var(--border-subtle);
}

@keyframes modalFade {
  from { opacity: 0; transform: scale(.94);}
  to { opacity: 1; transform: scale(1);}
}

.modal-close-btn {
  position: absolute;
  right: 12px;
  top: 10px;
  background: transparent;
  border: none;
  font-size: 22px;
  cursor: pointer;
  color: var(--text-muted);
}

.modal-title {
  font-size: 17px;
  font-weight: 600;
  margin-bottom: 14px;
}

.modal-event-item {
  padding: 10px;
  border-radius: 12px;
  background: var(--bg-soft);
  margin-bottom: 8px;
  border: 1px solid var(--border-subtle);
  font-size: 13px;
}

/* ===== GLOBAL SEARCH ===== */

.search-box {
  margin-bottom: 14px;
}

.search-results {
  border-radius: 14px;
  background: var(--bg-elevated);
  border: 1px solid var(--border-subtle);
  padding: 12px;
  margin-top: 10px;
}

.search-item {
  padding: 8px 4px;
  border-bottom: 1px solid var(--border-subtle);
  font-size: 13px;
}

.search-item:last-child {
  border-bottom: none;
}

.modal-box {
  background: var(--bg-elevated);
  padding: 22px;
  border-radius: 18px;
  width: min(92%, 420px);
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 40px rgba(0,0,0,0.4);
  animation: modalFade .25s ease-out;
  position: relative;
  border: 1px solid var(--border-subtle);
}

@keyframes modalFade {
  from { opacity: 0; transform: scale(.94);}
  to { opacity: 1; transform: scale(1);}
}

.modal-close-btn {
  position: absolute;
  right: 12px;
  top: 10px;
  background: transparent;
  border: none;
  font-size: 22px;
  cursor: pointer;
  color: var(--text-muted);
}

.modal-title {
  font-size: 17px;
  font-weight: 600;
  margin-bottom: 14px;
}

.modal-event-item {
  padding: 10px;
  border-radius: 12px;
  background: var(--bg-soft);
  margin-bottom: 8px;
  border: 1px solid var(--border-subtle);
  font-size: 13px;
}

/* ===== GLOBAL SEARCH ===== */

.search-box {
  margin-bottom: 14px;
}

.search-results {
  border-radius: 14px;
  background: var(--bg-elevated);
  border: 1px solid var(--border-subtle);
  padding: 12px;
  margin-top: 10px;
}

.search-item {
  padding: 8px 4px;
  border-bottom: 1px solid var(--border-subtle);
  font-size: 13px;
}

.search-item:last-child {
  border-bottom: none;
}

    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      -webkit-font-smoothing: antialiased;
      background: var(--bg);
      color: var(--text-primary);
    }

    body.light {
      --bg: #f3f4f6;
      --bg-elevated: #ffffff;
      --bg-soft: #e5e7eb;
      --text-primary: #0f172a;
      --text-muted: #6b7280;
      --accent: #8b5cf6;
      --accent-soft: rgba(139, 92, 246, 0.12);
      --accent-strong: #7c3aed;
      --border-subtle: #e5e7eb;
      --chip-bg: #111827;
    }

    body.dark {
      --bg: #0b1120;
      --bg-elevated: #020617;
      --bg-soft: #111827;
      --text-primary: #e5e7eb;
      --text-muted: #9ca3af;
      --accent: #c4b5fd;
      --accent-soft: rgba(196, 181, 253, 0.18);
      --accent-strong: #a855f7;
      --border-subtle: #1f2937;
      --chip-bg: #111827;
    }

    #root {
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 32px 16px;
      box-sizing: border-box;
    }

    .app-shell {
      width: 100%;
      max-width: 1120px;
      background: radial-gradient(circle at top left,
          rgba(139, 92, 246, 0.16),
          transparent 52%),
        radial-gradient(circle at bottom right,
          rgba(56, 189, 248, 0.18),
          transparent 55%),
        var(--bg-elevated);
      border-radius: 32px;
      box-shadow: var(--shadow-soft);
      padding: 24px;
      box-sizing: border-box;
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: var(--text-primary);
      position: relative;
    }

    @media (max-width: 768px) {
      #root {
        padding: 16px 8px;
      }
      .app-shell {
        padding: 20px 16px;
        border-radius: 24px;
      }
    }

    .app-header {
      display: flex;
      gap: 16px;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 18px;
    }

    .app-title {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .pill-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.55);
      color: #e5e7eb;
      font-size: 11px;
      letter-spacing: 0.09em;
      text-transform: uppercase;
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.4);
    }

    .app-title h1 {
      font-size: 22px;
      margin: 0;
    }

    .app-title p {
      margin: 0;
      font-size: 13px;
      color: var(--text-muted);
      max-width: 520px;
    }

    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 10px;
    }

    .theme-toggle {
      border-radius: 999px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      padding: 4px 6px;
      font-size: 18px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition-fast);
    }

    .theme-toggle:hover {
      transform: translateY(-1px);
      color: var(--accent-strong);
    }

    .storage-note {
      font-size: 11px;
      color: var(--text-muted);
      text-align: right;
    }

    .tabs-row {
      display: inline-flex;
      border-radius: 999px;
      padding: 4px;
      background: rgba(15, 23, 42, 0.8);
      margin-bottom: 20px;
      color: #e5e7eb;
    }

    .tab-btn {
      border: none;
      background: transparent;
      color: inherit;
      font-size: 13px;
      padding: 6px 18px;
      border-radius: 999px;
      cursor: pointer;
      opacity: 0.7;
      transition: var(--transition-fast);
      white-space: nowrap;
    }

    .tab-btn.active {
      background: radial-gradient(circle at top left,
          #f97316,
          #8b5cf6 55%,
          #0ea5e9 100%);
      opacity: 1;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.45);
    }

    .tab-btn:not(.active):hover {
      opacity: 1;
    }

    /* MODAL POPUP NOVO */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .modal-box {
      width: calc(100% - 40px);
      max-width: 420px;
      background: var(--bg-elevated);
      color: var(--text-primary);
      border-radius: 18px;
      padding: 18px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-subtle);
    }

    .modal-title {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .modal-close-btn {
      background: transparent;
      border: none;
      font-size: 18px;
      color: var(--text-muted);
      cursor: pointer;
      position: absolute;
      top: 10px;
      right: 14px;
    }

    .modal-event-item {
      padding: 10px;
      border-radius: 12px;
      background: var(--bg-soft);
      margin-bottom: 8px;
      font-size: 13px;
      border: 1px solid var(--border-subtle);
    }

  </style>
</head>

<body class="light">
  <div id="root"></div>
  <!-- React + Babel + libs -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script type="text/babel">

    const { useState, useEffect, useMemo } = React;

    const STORAGE_KEY = "painel_prestes_v4";

    const money = (n) =>
      "R$ " +
      (n || 0).toLocaleString("pt-BR", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      });

    const monthLabel = (year, monthIndex) =>
      new Date(year, monthIndex, 1).toLocaleDateString("pt-BR", {
        month: "long",
        year: "numeric",
      });

    const pad2 = (n) => String(n).padStart(2, "0");

    const addMonths = (year, monthIndex, delta) => {
      const d = new Date(year, monthIndex + delta, 1);
      return { year: d.getFullYear(), month: d.getMonth() };
    };

    const cycleStatus = (status) => {
      if (status === "pendente") return "parcial";
      if (status === "parcial") return "pago";
      return "pendente";
    };

    /* ‚≠ê COMPONENTE DE STATUS */
    function StatusPill({ status }) {
      return (
        <span className={`pill-status ${status}`}>
          {status === "pendente"
            ? "Pendente"
            : status === "parcial"
            ? "Pago parcial"
            : "Pago"}
        </span>
      );
    }

    /* ‚≠ê‚≠ê NOVO: MODAL PARA MOSTRAR EVENTOS DO DIA */
    function DayModal({ open, onClose, items, date }) {
      if (!open) return null;

      return (
        <div className="modal-backdrop" onClick={onClose}>
          <div className="modal-box" onClick={(e) => e.stopPropagation()}>
            <button className="modal-close-btn" onClick={onClose}>√ó</button>
            <div className="modal-title">
              Eventos em {date}
            </div>

            {items.length === 0 && (
              <div style={{ fontSize: 13, opacity: 0.6 }}>
                Nenhum evento neste dia.
              </div>
            )}

            {items.map((ev) => (
              <div key={ev.id} className="modal-event-item">
                <strong>{ev.titulo}</strong><br />
                {ev.empresa || "Sem empresa"}<br />
                Valor: {money(ev.valor)}<br />
                Status: <StatusPill status={ev.status} /><br />
                {ev.observacao && (
                  <span style={{ fontSize: 12, opacity: 0.8 }}>
                    Obs: {ev.observacao}
                  </span>
                )}
              </div>
            ))}
          </div>
        </div>
      );
    }

    /* ‚≠ê‚≠ê‚≠ê NOVO: BARRA DE BUSCA GLOBAL (eventos + d√≠vidas) */
    function GlobalSearch({ events, debts }) {
      const [query, setQuery] = useState("");

      const results = useMemo(() => {
        const q = query.toLowerCase();

        if (!q.trim()) return [];

        const ev = events
          .filter(
            (e) =>
              e.titulo.toLowerCase().includes(q) ||
              e.empresa.toLowerCase().includes(q) ||
              (e.observacao || "").toLowerCase().includes(q)
          )
          .map((e) => ({
            tipo: "Evento",
            titulo: e.titulo,
            sub: `${e.empresa} ‚Äì ${e.data}`,
            valor: e.valor,
            status: e.status,
          }));

        const dv = debts
          .filter(
            (d) =>
              d.conta.toLowerCase().includes(q) ||
              (d.observacao || "").toLowerCase().includes(q)
          )
          .map((d) => ({
            tipo: "D√≠vida",
            titulo: d.conta,
            sub: `${d.mesReferencia}`,
            valor: d.valorParcela,
            status: d.status,
          }));

        return [...ev, ...dv];
      }, [query, events, debts]);

      return (
        <div style={{ marginBottom: 16 }}>
          <input
            className="form-input"
            placeholder="Buscar evento ou d√≠vida..."
            value={query}
            onChange={(e) => setQuery(e.target.value)}
            style={{
              width: "100%",
              padding: "8px 10px",
              borderRadius: "12px",
              fontSize: 13,
            }}
          />

          {query && (
            <div
              style={{
                marginTop: 10,
                background: "var(--bg-soft)",
                padding: 10,
                borderRadius: 12,
                border: "1px solid var(--border-subtle)",
              }}
            >
              {results.length === 0 && (
                <div style={{ fontSize: 12, opacity: 0.6 }}>
                  Nenhum resultado.
                </div>
              )}

              {results.map((r, i) => (
                <div
                  key={i}
                  style={{
                    padding: "6px 4px",
                    borderBottom:
                      i < results.length - 1
                        ? "1px solid var(--border-subtle)"
                        : "none",
                  }}
                >
                  <strong>{r.titulo}</strong>{" "}
                  <span style={{ fontSize: 11, opacity: 0.7 }}>({r.tipo})</span>
                  <br />
                  <span style={{ fontSize: 11, opacity: 0.6 }}>{r.sub}</span>
                  <br />
                  <span
                    style={{
                      fontSize: 12,
                      color:
                        r.tipo === "Evento"
                          ? "#22c55e"
                          : "#f97316",
                      fontWeight: 600,
                    }}
                  >
                    {money(r.valor)}
                  </span>
                  <br />
                  <StatusPill status={r.status} />
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }
    /* ‚≠ê DASHBOARD */
    function Dashboard({ events, debts, onExportPDF }) {
      const summary = useMemo(() => {
        let receitaConfirmada = 0;
        let eventosParciaisQtd = 0;
        let eventosParciaisValor = 0;
        let totalEventos = 0;

        events.forEach((ev) => {
          totalEventos += ev.valor || 0;

          if (ev.status === "pago") receitaConfirmada += ev.valor || 0;

          if (ev.status === "parcial") {
            eventosParciaisQtd += 1;
            eventosParciaisValor += ev.valorPagoParcial || 0;
          }
        });

        let dividasQuitadas = 0;
        let dividasParciaisQtd = 0;
        let dividasParciaisValor = 0;
        let totalDividas = 0;

        debts.forEach((d) => {
          totalDividas += d.valorParcela || 0;

          if (d.status === "pago") dividasQuitadas += d.valorParcela || 0;

          if (d.status === "parcial") {
            dividasParciaisQtd += 1;
            dividasParciaisValor += d.valorPagoParcial || 0;
          }
        });

        const fluxoLiquido = receitaConfirmada - dividasQuitadas;

        const timeline = [
          ...events.map((ev) => ({
            id: `ev-${ev.id}`,
            tipo: "Evento",
            createdAt: ev.createdAt || 0,
            titulo: ev.titulo,
            valor: ev.valor,
            status: ev.status,
            data: ev.data,
          })),
          ...debts.map((d) => ({
            id: `dv-${d.id}`,
            tipo: "D√≠vida",
            createdAt: d.createdAt || 0,
            titulo: d.conta,
            valor: d.valorParcela,
            status: d.status,
            data: d.mesReferencia + "-01",
          })),
        ]
          .sort((a, b) => b.createdAt - a.createdAt)
          .slice(0, 6);

        return {
          receitaConfirmada,
          eventosParciaisQtd,
          eventosParciaisValor,
          totalEventos,
          dividasQuitadas,
          dividasParciaisQtd,
          dividasParciaisValor,
          totalDividas,
          fluxoLiquido,
          timeline,
        };
      }, [events, debts]);

      return (
        <div className="card">
          <div className="card-header-row">
            <div>
              <div className="card-title">Vis√£o geral</div>
              <div className="card-subtitle">
                Eventos fechados, d√≠vidas e fluxo confirmado.
              </div>
            </div>

            <button className="btn-outline" onClick={onExportPDF}>
              Exportar PDF
            </button>
          </div>

          <div className="card-kpi-row">
            <div className="kpi-card">
              <div className="kpi-label">Receita confirmada</div>
              <div className="kpi-main positive">
                {money(summary.receitaConfirmada)}
              </div>
              <div className="kpi-extra">
                Total em eventos: {money(summary.totalEventos)}
              </div>
            </div>

            <div className="kpi-card">
              <div className="kpi-label">D√≠vidas quitadas</div>
              <div className="kpi-main negative">
                {money(summary.dividasQuitadas)}
              </div>
              <div className="kpi-extra">
                Total em d√≠vidas: {money(summary.totalDividas)}
              </div>
            </div>

            <div className="kpi-card">
              <div className="kpi-label">Eventos parcial</div>
              <div className="kpi-main">
                {summary.eventosParciaisQtd} evento(s)
              </div>
              <div className="kpi-extra">
                J√° recebido: {money(summary.eventosParciaisValor)}
              </div>
            </div>

            <div className="kpi-card">
              <div className="kpi-label">D√≠vidas parcial</div>
              <div className="kpi-main">
                {summary.dividasParciaisQtd} conta(s)
              </div>
              <div className="kpi-extra">
                J√° pago: {money(summary.dividasParciaisValor)}
              </div>
            </div>
          </div>

          <div className="section">
            <div className="section-title-row">
              <div className="section-title">Fluxo l√≠quido</div>
              <div className="section-helper">
                Receita confirmada ‚Äì d√≠vidas quitadas
              </div>
            </div>
            <div className="kpi-card" style={{ marginBottom: 6 }}>
              <div className="kpi-main positive">
                {money(summary.fluxoLiquido)}
              </div>
            </div>
          </div>

          <div className="section">
            <div className="section-title-row">
              <div className="section-title">Linha do tempo</div>
              <div className="section-helper">
                √öltimos eventos e d√≠vidas cadastrados
              </div>
            </div>

            <div className="timeline">
              {summary.timeline.length === 0 && (
                <div
                  className="timeline-item"
                  style={{ color: "var(--text-muted)" }}
                >
                  Sem registros ainda.
                </div>
              )}

              {summary.timeline.map((item) => (
                <div key={item.id} className="timeline-item">
                  <div>
                    <strong>{item.titulo}</strong>{" "}
                    <span style={{ fontSize: 10, opacity: 0.7 }}>
                      ¬∑ {item.tipo}
                    </span>
                    <div
                      style={{
                        fontSize: 10,
                        color: "var(--text-muted)",
                      }}
                    >
                      {item.data}
                    </div>
                  </div>

                  <div style={{ textAlign: "right" }}>
                    <div
                      className={
                        item.tipo === "Evento"
                          ? "chip-amount"
                          : "chip-amount-negative"
                      }
                    >
                      {money(item.valor)}
                    </div>
                    <StatusPill status={item.status} />
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }
    /* ‚≠ê EVENTOS */
    function EventosSection({
      events,
      setEvents,
      eventMonth,
      setEventMonth,
    }) {
      const today = new Date();
      const [form, setForm] = useState({
        data: today.toISOString().slice(0, 10),
        titulo: "",
        empresa: "",
        valor: "",
        forma: "Pix",
        observacao: "",
      });

      const [editingId, setEditingId] = useState(null);

      const [dayModalOpen, setDayModalOpen] = useState(false);
      const [dayModalItems, setDayModalItems] = useState([]);
      const [dayModalDate, setDayModalDate] = useState("");

      const handleChange = (field, value) => {
        setForm((f) => ({ ...f, [field]: value }));
      };

      useEffect(() => {
        if (!editingId) return;
        const ev = events.find((e) => e.id === editingId);
        if (!ev) return;

        setForm({
          data: ev.data,
          titulo: ev.titulo,
          empresa: ev.empresa,
          valor: String(ev.valor),
          forma: ev.forma,
          observacao: ev.observacao,
        });
      }, [editingId]);

      const resetForm = () => {
        setForm({
          data: today.toISOString().slice(0, 10),
          titulo: "",
          empresa: "",
          valor: "",
          forma: "Pix",
          observacao: "",
        });
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        const valor = parseFloat(form.valor.replace(",", ".")) || 0;

        if (!form.data || !form.titulo || valor <= 0) return;

        if (editingId) {
          setEvents((prev) =>
            prev.map((ev) =>
              ev.id === editingId
                ? {
                    ...ev,
                    data: form.data,
                    titulo: form.titulo,
                    empresa: form.empresa,
                    valor,
                    forma: form.forma,
                    observacao: form.observacao,
                  }
                : ev
            )
          );
          setEditingId(null);
          resetForm();
          return;
        }

        const createdAt = Date.now();
        setEvents((prev) => [
          ...prev,
          {
            id: createdAt.toString(),
            createdAt,
            data: form.data,
            titulo: form.titulo,
            empresa: form.empresa,
            valor,
            forma: form.forma,
            status: "pendente",
            valorPagoParcial: 0,
            observacao: form.observacao,
          },
        ]);

        resetForm();
      };

      const handleDayClick = (cell) => {
        if (!cell.day || cell.outside) return;

        const { year, month } = eventMonth;
        const iso = new Date(year, month, cell.day)
          .toISOString()
          .slice(0, 10);

        const items = events.filter((ev) => ev.data === iso);

        setDayModalOpen(true);
        setDayModalItems(items);
        setDayModalDate(iso);
      };

      const handlePrevMonth = () =>
        setEventMonth((m) => addMonths(m.year, m.month, -1));
      const handleNextMonth = () =>
        setEventMonth((m) => addMonths(m.year, m.month, 1));

      const monthKey =
        eventMonth.year + "-" + pad2(eventMonth.month + 1);

      const eventsThisMonth = events.filter(
        (ev) => ev.data.slice(0, 7) === monthKey
      );

      const weeks = useMemo(() => {
        const { year, month } = eventMonth;
        const first = new Date(year, month, 1);
        const firstWeekday = first.getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        const cells = [];

        for (let i = 0; i < 42; i++) {
          const dayNum = i - firstWeekday + 1;

          if (dayNum < 1 || dayNum > daysInMonth) {
            cells.push({ key: `x-${i}`, outside: true });
          } else {
            const iso = new Date(year, month, dayNum)
              .toISOString()
              .slice(0, 10);

            cells.push({
              key: iso,
              outside: false,
              day: dayNum,
              items: events.filter((ev) => ev.data === iso),
            });
          }
        }

        return cells;
      }, [eventMonth, events]);

      const handleToggleStatus = (id) => {
        setEvents((prev) =>
          prev.map((ev) =>
            ev.id === id ? { ...ev, status: cycleStatus(ev.status) } : ev
          )
        );
      };

      return (
        <div className="card">
          <DayModal
            open={dayModalOpen}
            onClose={() => setDayModalOpen(false)}
            items={dayModalItems}
            date={dayModalDate}
          />

          <div className="card-header-row">
            <div>
              <div className="card-title">Eventos</div>
              <div className="card-subtitle">
                Calend√°rio mensal com eventos e pagamentos.
              </div>
            </div>
          </div>

          <div className="section">
            <div className="section-title-row">
              <div className="section-title">
                Calend√°rio ‚Äî {monthLabel(eventMonth.year, eventMonth.month)}
              </div>

              <div className="calendar-nav">
                <button className="icon-btn" onClick={handlePrevMonth}>‚Äπ</button>
                <button className="icon-btn" onClick={handleNextMonth}>‚Ä∫</button>
              </div>
            </div>

            <div className="calendar">
              <div className="calendar-grid-header">
                {["D", "S", "T", "Q", "Q", "S", "S"].map((d) => (
                  <div key={d} className="calendar-weekday">
                    {d}
                  </div>
                ))}
              </div>

              <div className="calendar-grid">
                {weeks.map((cell) => (
                  <div
                    key={cell.key}
                    className={
                      "calendar-day" + (cell.outside ? " outside" : "")
                    }
                    onClick={() => handleDayClick(cell)}
                  >
                    {!cell.outside && (
                      <>
                        <div className="calendar-day-number">{cell.day}</div>
                        <div className="calendar-chips">
                          {cell.items
                            .slice(0, 3)
                            .map((ev) => (
                              <div key={ev.id} className="calendar-chip">
                                {ev.titulo}
                              </div>
                            ))}
                          {cell.items.length > 3 && (
                            <div className="calendar-chip">
                              +{cell.items.length - 3}
                            </div>
                          )}
                        </div>
                      </>
                    )}
                  </div>
                ))}
              </div>
            </div>
          </div>

          <GlobalSearch events={events} debts={[]} />

          {/* Lista de eventos no m√™s */}
          <div className="section">
            <div className="section-title-row">
              <div className="section-title">
                Eventos deste m√™s ({eventsThisMonth.length})
              </div>
            </div>

            <div className="list">
              {eventsThisMonth.map((ev) => (
                <div key={ev.id} className="list-item">
                  <div className="list-item-main-row">
                    <div>
                      <div className="list-item-title">{ev.titulo}</div>
                      <div className="list-item-sub">
                        {ev.empresa} ¬∑ {ev.data}
                      </div>
                    </div>

                    <div>
                      <div className="chip-amount">{money(ev.valor)}</div>
                      <StatusPill status={ev.status} />
                    </div>
                  </div>

                  <button
                    className="btn-ghost btn-small"
                    onClick={() => handleToggleStatus(ev.id)}
                  >
                    Girar status
                  </button>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    /* ‚≠ê D√çVIDAS */
    function DividasSection({ debts, setDebts, debtMonth, setDebtMonth }) {
      const monthKey =
        debtMonth.year + "-" + pad2(debtMonth.month + 1);

      const debtsThisMonth = debts.filter(
        (d) => d.mesReferencia === monthKey
      );

      const handleToggleStatus = (id) => {
        setDebts((prev) =>
          prev.map((d) =>
            d.id === id ? { ...d, status: cycleStatus(d.status) } : d
          )
        );
      };

      const handlePrevMonth = () =>
        setDebtMonth((m) => addMonths(m.year, m.month, -1));
      const handleNextMonth = () =>
        setDebtMonth((m) => addMonths(m.year, m.month, 1));

      return (
        <div className="card">
          <div className="card-header-row">
            <div>
              <div className="card-title">D√≠vidas</div>
              <div className="card-subtitle">
                Todas as parcelas do m√™s selecionado.
              </div>
            </div>
          </div>

          <GlobalSearch events={[]} debts={debts} />

          <div className="section">
            <div className="section-title">
              M√™s: {monthLabel(debtMonth.year, debtMonth.month)}
            </div>

            <div className="calendar-nav">
              <button className="icon-btn" onClick={handlePrevMonth}>‚Äπ</button>
              <button className="icon-btn" onClick={handleNextMonth}>‚Ä∫</button>
            </div>
          </div>

          <div className="list">
            {debtsThisMonth.map((d) => (
              <div key={d.id} className="list-item">
                <div className="list-item-main-row">
                  <div>
                    <div className="list-item-title">{d.conta}</div>
                    <div className="list-item-sub">{d.mesReferencia}</div>
                  </div>
                  <div>
                    <div className="chip-amount-negative">
                      {money(d.valorParcela)}
                    </div>
                    <StatusPill status={d.status} />
                  </div>
                </div>

                <button
                  className="btn-ghost btn-small"
                  onClick={() => handleToggleStatus(d.id)}
                >
                  Girar status
                </button>
              </div>
            ))}
          </div>
        </div>
      );
    }

    /* ‚≠ê APP PRINCIPAL */
    function App() {
      const saved = useMemo(() => {
        try {
          return JSON.parse(localStorage.getItem(STORAGE_KEY));
        } catch {
          return null;
        }
      }, []);

      const today = new Date();

      const [events, setEvents] = useState(saved?.events || []);
      const [debts, setDebts] = useState(saved?.debts || []);
      const [theme, setTheme] = useState(saved?.theme || "light");

      const [activeTab, setActiveTab] = useState("dashboard");

      const [eventMonth, setEventMonth] = useState({
        year: today.getFullYear(),
        month: today.getMonth(),
      });

      const [debtMonth, setDebtMonth] = useState({
        year: today.getFullYear(),
        month: today.getMonth(),
      });

      useEffect(() => {
        document.body.classList.remove("light", "dark");
        document.body.classList.add(theme);
      }, [theme]);

      useEffect(() => {
        localStorage.setItem(
          STORAGE_KEY,
          JSON.stringify({
            events,
            debts,
            theme,
          })
        );
      }, [events, debts, theme]);

      return (
        <div className="app-shell">
          <header className="app-header">
            <div className="app-title">
              <div className="pill-badge">
                <span className="pill-dot" />
                painel financeiro ¬∑ prestes
              </div>

              <h1>Seu painel financeiro profissional</h1>
              <p>
                Tudo salvo no navegador: eventos, d√≠vidas e status de
                pagamento.
              </p>
            </div>

            <button
              className="theme-toggle"
              onClick={() =>
                setTheme((t) => (t === "light" ? "dark" : "light"))
              }
            >
              {theme === "dark" ? "üåô" : "‚òÄÔ∏è"}
            </button>
          </header>

          <div className="tabs-row">
            <button
              className={
                "tab-btn" + (activeTab === "dashboard" ? " active" : "")
              }
              onClick={() => setActiveTab("dashboard")}
            >
              Dashboard
            </button>

            <button
              className={
                "tab-btn" + (activeTab === "eventos" ? " active" : "")
              }
              onClick={() => setActiveTab("eventos")}
            >
              Eventos
            </button>

            <button
              className={
                "tab-btn" + (activeTab === "dividas" ? " active" : "")
              }
              onClick={() => setActiveTab("dividas")}
            >
              D√≠vidas
            </button>
          </div>

          {activeTab === "dashboard" && (
            <Dashboard
              events={events}
              debts={debts}
              onExportPDF={() => {}}
            />
          )}

          {activeTab === "eventos" && (
            <EventosSection
              events={events}
              setEvents={setEvents}
              eventMonth={eventMonth}
              setEventMonth={setEventMonth}
            />
          )}

          {activeTab === "dividas" && (
            <DividasSection
              debts={debts}
              setDebts={setDebts}
              debtMonth={debtMonth}
              setDebtMonth={setDebtMonth}
            />
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
