<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel Financeiro â€“ Prestes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --radius: 14px;
      --radius-lg: 22px;
      --shadow: 0 12px 32px rgba(0,0,0,0.25);
      --transition: .18s ease-out;
    }

    body {
      margin: 0;
      font-family: system-ui,-apple-system,"SF Pro Text",sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background .25s, color .25s;
    }

    body.light {
      --bg: #f4f5f7;
      --bg-card: #ffffff;
      --bg-soft: #e6e7eb;
      --text: #0f172a;
      --text-muted: #6b7280;
      --accent: #8b5cf6;
      --accent-soft: rgba(139,92,246,.12);
    }

    body.dark {
      --bg: #0b1120;
      --bg-card: #0f172a;
      --bg-soft: #1a2333;
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --accent: #c4b5fd;
      --accent-soft: rgba(196,181,253,.14);
    }

    /* App structure */
    #root {
      padding: 24px;
      display: flex;
      justify-content: center;
    }

    .app-shell {
      width: 100%;
      max-width: 1100px;
      background: var(--bg-card);
      border-radius: 26px;
      padding: 22px;
      box-shadow: var(--shadow);
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }

    .title {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-muted);
      max-width: 480px;
    }

    /* Theme toggle â€“ DISCRETO */
    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      cursor: pointer;
      opacity: .65;
      transition: var(--transition);
      background: var(--bg-soft);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .theme-toggle:hover {
      opacity: 1;
    }

    /* Tabs */
    .tabs {
      margin: 22px 0 14px;
      display: flex;
      gap: 8px;
    }
    .tab-btn {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: var(--bg-soft);
      color: var(--text);
      font-size: 13px;
      transition: var(--transition);
    }
    .tab-btn.active {
      background: var(--accent);
      color: white;
    }

    /* Cards QUADRADINHOS (como vocÃª pediu!!) */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
      gap: 14px;
      margin-top: 12px;
    }
    .card {
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,.12);
      display: flex;
      flex-direction: column;
    }
    .card-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .value {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .muted {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Calendar */
    .calendar {
      border-radius: var(--radius);
      background: var(--bg-card);
      padding: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,.12);
    }
    .cal-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .cal-grid {
      display: grid;
      grid-template-columns: repeat(7,1fr);
      gap: 4px;
    }
    .day {
      min-height: 50px;
      background: var(--bg-soft);
      border-radius: 10px;
      padding: 3px;
      font-size: 10px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .day:hover {
      background: var(--accent-soft);
    }

    /* PDF beautification */
    .pdf-title {
      font-weight: bold;
      font-size: 20px;
      margin-bottom: 14px;
    }
    .pdf-section {
      margin-bottom: 18px;
    }

  </style>
</head>

<body class="light">
  <div class="theme-toggle" id="themeToggle">ðŸŒ—</div>
  <div id="root"></div>

  <!-- libs -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script type="text/babel">

// ===============================
// ðŸ”§ UTILITÃRIOS
// ===============================

const { useState, useEffect, useMemo } = React;

const STORAGE_KEY = "painel_prestes_upgrade_final";

// Formata nÃºmero
const money = (n) =>
  "R$ " +
  (n || 0).toLocaleString("pt-BR", {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  });

// Formata mÃªs "MarÃ§o 2025"
const monthLabel = (year, monthIndex) =>
  new Date(year, monthIndex, 1).toLocaleDateString("pt-BR", {
    month: "long",
    year: "numeric",
  });

// Coloca 0 na frente: 02, 07
const pad2 = (n) => String(n).padStart(2, "0");

// AvanÃ§a meses
const addMonths = (year, monthIndex, delta) => {
  const d = new Date(year, monthIndex + delta, 1);
  return { year: d.getFullYear(), month: d.getMonth() };
};

// Cicla status
const cycleStatus = (s) => (s === "pendente" ? "parcial" : s === "parcial" ? "pago" : "pendente");

// Cores do status no chip
function StatusPill({ status }) {
  const label =
    status === "pendente"
      ? "Pendente"
      : status === "parcial"
      ? "Parcial"
      : "Pago";

  return (
    <span
      style={{
        padding: "2px 8px",
        borderRadius: "999px",
        fontSize: "10px",
        background:
          status === "pago"
            ? "rgba(34,197,94,.25)"
            : status === "parcial"
            ? "rgba(250,204,21,.35)"
            : "rgba(239,68,68,.30)",
        color:
          status === "pago"
            ? "#22c55e"
            : status === "parcial"
            ? "#eab308"
            : "#ef4444",
      }}
    >
      {label}
    </span>
  );
}

// ===============================
// ðŸŽ¨ TEMA (CLARO/ESCURO)
// ===============================

document.getElementById("themeToggle").onclick = () => {
  document.body.classList.toggle("dark");
  document.body.classList.toggle("light");

  const newTheme = document.body.classList.contains("dark") ? "dark" : "light";
  localStorage.setItem(STORAGE_KEY + "_theme", newTheme);
};

// Carrega tema salvo
const savedTheme = localStorage.getItem(STORAGE_KEY + "_theme");
if (savedTheme) {
  document.body.classList.remove("light", "dark");
  document.body.classList.add(savedTheme);
}

// ===============================
// ðŸ’¾ PERSISTÃŠNCIA
// ===============================

function usePersistentState(key, defaultValue) {
  const saved = useMemo(() => {
    try {
      const raw = localStorage.getItem(key);
      if (!raw) return null;
      return JSON.parse(raw);
    } catch {
      return null;
    }
  }, [key]);

  const [value, setValue] = useState(saved || defaultValue);

  useEffect(() => {
    try {
      localStorage.setItem(key, JSON.stringify(value));
    } catch {}
  }, [key, value]);

  return [value, setValue];
}

// ===============================
// ðŸ“„ PDF LINDO, ORGANIZADO, COM CORES
// ===============================

async function gerarPDFBonito({ events, debts }) {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p", "mm", "a4");

  const pageWidth = pdf.internal.pageSize.getWidth();
  let y = 14;

  const titulo = (t) => {
    pdf.setFont("Helvetica", "bold");
    pdf.setFontSize(18);
    pdf.text(t, pageWidth / 2, y, { align: "center" });
    y += 10;
  };

  const secao = (nome) => {
    y += 6;
    pdf.setFont("Helvetica", "bold");
    pdf.setFontSize(14);
    pdf.text(nome, 12, y);
    y += 4;
  };

  const linha = (txt) => {
    pdf.setFont("Helvetica", "normal");
    pdf.setFontSize(11);
    const lines = pdf.splitTextToSize(txt, pageWidth - 24);
    pdf.text(lines, 12, y);
    y += 6 * lines.length;
  };

  titulo("Painel Financeiro â€“ Prestes");

  // ============ EVENTOS ============
  secao("EVENTOS");
  if (events.length === 0) {
    linha("Nenhum evento cadastrado.");
  } else {
    events
      .slice()
      .sort((a, b) => (a.data || "").localeCompare(b.data || ""))
      .forEach((ev) => {
        linha(
          `â€¢ ${ev.data} â€“ ${ev.titulo} (${ev.empresa || "Sem empresa"}) â€” ` +
            `${money(ev.valor)} â€” Status: ${ev.status}`
        );
        if (ev.observacao) linha("  Obs: " + ev.observacao);
      });
  }

  // ============ DÃVIDAS ============
  secao("DÃVIDAS / PARCELAS");
  if (debts.length === 0) {
    linha("Nenhuma conta cadastrada.");
  } else {
    debts
      .slice()
      .sort((a, b) => a.mesReferencia.localeCompare(b.mesReferencia))
      .forEach((d) => {
        linha(
          `â€¢ ${d.mesReferencia} â€“ ${d.conta} â€” Parcela ${money(
            d.valorParcela
          )} â€” Status: ${d.status}`
        );
        if (d.observacao) linha("  Obs: " + d.observacao);
      });
  }

  pdf.save("painel-prestes.pdf");
}

// ===============================
// ðŸš€ EXPORTAÃ‡ÃƒO PARA O RESTO DO APP
