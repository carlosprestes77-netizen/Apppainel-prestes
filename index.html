<style>
/* … todo o seu CSS anterior permanece aqui … */

/* BOTÕES DE EDIÇÃO E EXCLUSÃO */
.edit-btn, .delete-btn {
  padding: 4px 8px;
  border-radius: 8px;
  font-size: 10px;
  cursor: pointer;
  border: none;
  transition: 0.15s ease-out;
}

.edit-btn {
  background: #3b82f6;
  color: white;
}
.edit-btn:hover {
  filter: brightness(1.1);
}

.delete-btn {
  background: #ef4444;
  color: white;
}
.delete-btn:hover {
  filter: brightness(1.1);
}
</style>
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    const STORAGE_KEY = "painel_prestes_v3";

    const money = (n) =>
      "R$ " +
      (n || 0).toLocaleString("pt-BR", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      });

    const monthLabel = (year, monthIndex) =>
      new Date(year, monthIndex, 1).toLocaleDateString("pt-BR", {
        month: "long",
        year: "numeric",
      });

    const pad2 = (n) => String(n).padStart(2, "0");

    const addMonths = (year, monthIndex, delta) => {
      const d = new Date(year, monthIndex + delta, 1);
      return { year: d.getFullYear(), month: d.getMonth() };
    };

    const cycleStatus = (status) => {
      if (status === "pendente") return "parcial";
      if (status === "parcial") return "pago";
      return "pendente";
    };

    const STATUS_ORDER = ["pendente", "parcial", "pago"];

    function StatusPill({ status }) {
      return (
        <span className={`pill-status ${status}`}>
          {status === "pendente"
            ? "Pendente"
            : status === "parcial"
            ? "Pago parcial"
            : "Pago"}
        </span>
      );
    }

    /* DASHBOARD (SEM MUDAR LAYOUT) */
    function Dashboard({ events, debts, onExportPDF }) {
      const summary = useMemo(() => {
        let receitaConfirmada = 0;
        let eventosParciaisQtd = 0;
        let eventosParciaisValor = 0;
        let totalEventos = 0;

        events.forEach((ev) => {
          totalEventos += ev.valor || 0;
          if (ev.status === "pago") receitaConfirmada += ev.valor || 0;
          if (ev.status === "parcial") {
            eventosParciaisQtd += 1;
            eventosParciaisValor += ev.valorPagoParcial || 0;
          }
        });

        let dividasQuitadas = 0;
        let dividasParciaisQtd = 0;
        let dividasParciaisValor = 0;
        let totalDividas = 0;

        debts.forEach((d) => {
          totalDividas += d.valorParcela || 0;
          if (d.status === "pago") dividasQuitadas += d.valorParcela || 0;
          if (d.status === "parcial") {
            dividasParciaisQtd += 1;
            dividasParciaisValor += d.valorPagoParcial || 0;
          }
        });

        const fluxoLiquido = receitaConfirmada - dividasQuitadas;

        const timeline = [
          ...events.map((ev) => ({
            id: `ev-${ev.id}`,
            tipo: "Evento",
            createdAt: ev.createdAt || 0,
            titulo: ev.titulo,
            valor: ev.valor,
            status: ev.status,
            data: ev.data,
          })),
          ...debts.map((d) => ({
            id: `dv-${d.id}`,
            tipo: "Dívida",
            createdAt: d.createdAt || 0,
            titulo: d.conta,
            valor: d.valorParcela,
            status: d.status,
            data: d.mesReferencia + "-01",
          })),
        ]
          .sort((a, b) => b.createdAt - a.createdAt)
          .slice(0, 6);

        return {
          receitaConfirmada,
          eventosParciaisQtd,
          eventosParciaisValor,
          totalEventos,
          dividasQuitadas,
          dividasParciaisQtd,
          dividasParciaisValor,
          totalDividas,
          fluxoLiquido,
          timeline,
        };
      }, [events, debts]);

      return (
        <div className="card">
          <div className="card-header-row">
            <div>
              <div className="card-title">Visão geral</div>
              <div className="card-subtitle">
                Eventos fechados, dívidas e fluxo confirmado.
              </div>
            </div>
            <button className="btn-outline" onClick={onExportPDF}>
              Exportar PDF
            </button>
          </div>

          <div className="card-kpi-row">
            <div className="kpi-card">
              <div className="kpi-label">
                Receita confirmada (eventos pagos)
              </div>
              <div className="kpi-main positive">
                {money(summary.receitaConfirmada)}
              </div>
              <div className="kpi-extra">
                Total em eventos: {money(summary.totalEventos)}
              </div>
            </div>

            <div className="kpi-card">
              <div className="kpi-label">Dívidas quitadas</div>
              <div className="kpi-main negative">
                {money(summary.dividasQuitadas)}
              </div>
              <div className="kpi-extra">
                Total em dívidas: {money(summary.totalDividas)}
              </div>
            </div>

            <div className="kpi-card">
              <div className="kpi-label">Eventos com pagamento parcial</div>
              <div className="kpi-main">
                {summary.eventosParciaisQtd} evento(s)
              </div>
              <div className="kpi-extra">
                Já recebido: {money(summary.eventosParciaisValor)}
              </div>
            </div>

            <div className="kpi-card">
              <div className="kpi-label">Dívidas em pagamento parcial</div>
              <div className="kpi-main">
                {summary.dividasParciaisQtd} conta(s)
              </div>
              <div className="kpi-extra">
                Já pago: {money(summary.dividasParciaisValor)}
              </div>
            </div>
          </div>

          <div className="section">
            <div className="section-title-row">
              <div className="section-title">Fluxo líquido</div>
              <div className="section-helper">
                Receita confirmada – dívidas quitadas
              </div>
            </div>
            <div className="kpi-card" style={{ marginBottom: 6 }}>
              <div className="kpi-main positive">
                {money(summary.fluxoLiquido)}
              </div>
            </div>
          </div>

          <div className="section">
            <div className="section-title-row">
              <div className="section-title">Linha do tempo rápida</div>
              <div className="section-helper">
                Últimos eventos e dívidas cadastrados.
              </div>
            </div>
            <div className="timeline">
              {summary.timeline.length === 0 && (
                <div
                  className="timeline-item"
                  style={{ color: "var(--text-muted)" }}
                >
                  Ainda não há registros. Comece pelo painel de eventos ou
                  dívidas.
                </div>
              )}
              {summary.timeline.map((item) => (
                <div key={item.id} className="timeline-item">
                  <div>
                    <div>
                      <strong>{item.titulo || "Sem título"}</strong>{" "}
                      <span style={{ fontSize: 10, opacity: 0.7 }}>
                        · {item.tipo}
                      </span>
                    </div>
                    <div
                      style={{
                        fontSize: 10,
                        color: "var(--text-muted)",
                      }}
                    >
                      {item.data}
                    </div>
                  </div>
                  <div style={{ textAlign: "right" }}>
                    <div
                      className={
                        item.tipo === "Evento"
                          ? "chip-amount"
                          : "chip-amount-negative"
                      }
                    >
                      {money(item.valor)}
                    </div>
                    <StatusPill status={item.status} />
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    /* EVENTOS – agora com EDITAR e APAGAR sem mudar layout */
    function EventosSection({
      events,
      setEvents,
      eventMonth,
      setEventMonth,
      onPickDate,
    }) {
      const today = new Date();
      const defaultDate = today.toISOString().slice(0, 10);

      const [form, setForm] = useState({
        data: defaultDate,
        titulo: "",
        empresa: "",
        valor: "",
        forma: "Pix",
        observacao: "",
      });

      const [editingId, setEditingId] = useState(null);

      const handleChange = (field, value) => {
        setForm((f) => ({ ...f, [field]: value }));
      };

      const resetForm = () => {
        setForm({
          data: defaultDate,
          titulo: "",
          empresa: "",
          valor: "",
          forma: "Pix",
          observacao: "",
        });
        setEditingId(null);
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        const valor = parseFloat(String(form.valor).replace(",", ".")) || 0;
        if (!form.data || !form.titulo || valor <= 0) return;

        const base = {
          data: form.data,
          titulo: form.titulo,
          empresa: form.empresa || "",
          valor,
          forma: form.forma,
          observacao: form.observacao || "",
        };

        if (editingId) {
          // ATUALIZAR EVENTO EXISTENTE
          setEvents((prev) =>
            prev.map((ev) =>
              ev.id === editingId ? { ...ev, ...base } : ev
            )
          );
          resetForm();
        } else {
          // CRIAR NOVO EVENTO
          const createdAt = Date.now();
          const novo = {
            id: createdAt.toString(),
            createdAt,
            status: "pendente",
            valorPagoParcial: 0,
            ...base,
          };
          setEvents((prev) => [...prev, novo]);
          setForm((f) => ({
            ...f,
            titulo: "",
            empresa: "",
            valor: "",
            observacao: "",
          }));
        }
      };

      const handleToggleStatus = (id) => {
        setEvents((prev) =>
          prev.map((ev) =>
            ev.id === id ? { ...ev, status: cycleStatus(ev.status) } : ev
          )
        );
      };

      const handlePartialValueChange = (id, value) => {
        const n = parseFloat(String(value).replace(",", ".")) || 0;
        setEvents((prev) =>
          prev.map((ev) =>
            ev.id === id ? { ...ev, valorPagoParcial: n } : ev
          )
        );
      };

      const handleEditEvent = (ev) => {
        setEditingId(ev.id);
        setForm({
          data: ev.data || defaultDate,
          titulo: ev.titulo || "",
          empresa: ev.empresa || "",
          valor: ev.valor != null ? String(ev.valor) : "",
          forma: ev.forma || "Pix",
          observacao: ev.observacao || "",
        });
      };

      const handleDeleteEvent = (id) => {
        if (!window.confirm("Apagar este evento?")) return;
        setEvents((prev) => prev.filter((ev) => ev.id !== id));
        if (editingId === id) resetForm();
      };

      const monthKey =
        eventMonth.year + "-" + pad2(eventMonth.month + 1);

      const eventsThisMonth = events.filter(
        (ev) => ev.data && ev.data.slice(0, 7) === monthKey
      );

      const weeks = useMemo(() => {
        const { year, month } = eventMonth;
        const first = new Date(year, month, 1);
        const firstWeekday = first.getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const cells = [];
        for (let i = 0; i < 42; i++) {
          const dayNum = i - firstWeekday + 1;
          if (dayNum < 1 || dayNum > daysInMonth) {
            cells.push({ key: `x-${i}`, outside: true });
          } else {
            const dateObj = new Date(year, month, dayNum);
            const iso = dateObj.toISOString().slice(0, 10);
            const items = events.filter((ev) => ev.data === iso);
            cells.push({
              key: iso,
              outside: false,
              day: dayNum,
              items,
            });
          }
        }
        return cells;
      }, [eventMonth, events]);

      const handleDayClick = (cell) => {
        if (!cell.day || cell.outside) return;
        const { year, month } = eventMonth;
        const dateObj = new Date(year, month, cell.day);
        const iso = dateObj.toISOString().slice(0, 10);
        setForm((f) => ({ ...f, data: iso }));
        if (typeof onPickDate === "function") onPickDate(iso);
      };

      const handlePrevMonth = () =>
        setEventMonth((m) => addMonths(m.year, m.month, -1));
      const handleNextMonth = () =>
        setEventMonth((m) => addMonths(m.year, m.month, 1));

      return (
        <div className="card">
          <div className="card-header-row">
            <div>
              <div className="card-title">Eventos</div>
              <div className="card-subtitle">
                Calendário mensal com eventos, empresas e status de pagamento.
              </div>
            </div>
          </div>

          <div className="section">
            <div className="section-title-row">
              <div className="section-title">Calendário</div>
              <div className="section-helper">
                Toque no dia para preencher o formulário.
              </div>
            </div>
            <div className="calendar">
              <div className="calendar-header">
                <div className="calendar-month-label">
                  {monthLabel(eventMonth.year, eventMonth.month)}
                </div>
                <div className="calendar-nav">
                  <button className="icon-btn" onClick={handlePrevMonth}>
                    ‹
                  </button>
                  <button className="icon-btn" onClick={handleNextMonth}>
                    ›
                  </button>
                </div>
              </div>
              <div className="calendar-grid">
                {["D", "S", "T", "Q", "Q", "S", "S"].map((d) => (
                  <div key={d} className="calendar-weekday">
                    {d}
                  </div>
                ))}
                {weeks.map((cell) => (
                  <div
                    key={cell.key}
                    className={
                      "calendar-day" + (cell.outside ? " outside" : "")
                    }
                    onClick={() => handleDayClick(cell)}
                  >
                    {!cell.outside && (
                      <>
                        <div className="calendar-day-number">
                          {cell.day}
                        </div>
                        <div className="calendar-chips">
                          {cell.items &&
                            cell.items.slice(0, 3).map((ev) => (
                              <div
                                key={ev.id}
                                className="calendar-chip"
                                title={ev.titulo}
                              >
                                {ev.titulo || "Evento"}
                              </div>
                            ))}
                          {cell.items && cell.items.length > 3 && (
                            <div
                              className="calendar-chip"
                              style={{ opacity: 0.75 }}
                            >
                              +{cell.items.length - 3}
                            </div>
                          )}
                        </div>
                      </>
                    )}
                  </div>
                ))}
              </div>
            </div>
          </div>

          <div className="section">
            <div className="section-title-row">
              <div className="section-title">
                Eventos deste mês ({eventsThisMonth.length})
              </div>
              <div className="section-helper">
                Clique em “girar status” e preencha o valor parcial quando
                precisar. Use editar/apagar para corrigir erros.
              </div>
            </div>
            <div className="list">
              {eventsThisMonth.length === 0 && (
                <div
                  className="small-hint"
                  style={{ paddingInline: 4, color: "var(--text-muted)" }}
                >
                  Nenhum evento neste mês ainda.
                </div>
              )}
              {eventsThisMonth
                .slice()
                .sort((a, b) => (a.data || "").localeCompare(b.data || ""))
                .map((ev) => (
                  <div key={ev.id} className="list-item">
                    <div className="list-item-main-row">
                      <div>
                        <div className="list-item-title">
                          {ev.titulo || "Evento"}
                        </div>
                        <div className="list-item-sub">
                          {ev.empresa || "Sem empresa"} · {ev.data} ·{" "}
                          {ev.forma || "Pix"}
                        </div>
                      </div>
                      <div style={{ textAlign: "right" }}>
                        <div className="chip-amount">
                          {money(ev.valor || 0)}
                        </div>
                        <StatusPill status={ev.status} />
                      </div>
                    </div>
                    <div className="list-item-actions-row">
                      <div
                        style={{
                          display: "flex",
                          flexDirection: "column",
                          gap: 3,
                        }}
                      >
                        <span className="label-tag">Valor já pago (R$)</span>
                        <input
                          className="form-input"
                          style={{
                            maxWidth: 130,
                            fontSize: 11,
                            padding: "4px 6px",
                          }}
                          type="number"
                          min="0"
                          step="0.01"
                          value={
                            ev.valorPagoParcial === 0 ||
                            ev.valorPagoParcial
                              ? ev.valorPagoParcial
                              : ""
                          }
                          onChange={(e) =>
                            handlePartialValueChange(ev.id, e.target.value)
                          }
                        />
                      </div>
                      <div style={{ display: "flex", gap: 6, alignItems: "center" }}>
                        <button
                          className="edit-btn"
                          type="button"
                          onClick={() => handleEditEvent(ev)}
                        >
                          Editar
                        </button>
                        <button
                          className="delete-btn"
                          type="button"
                          onClick={() => handleDeleteEvent(ev.id)}
                        >
                          Apagar
                        </button>
                        <button
                          className="btn-ghost"
                          type="button"
                          onClick={() => handleToggleStatus(ev.id)}
                        >
                          Girar status
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
            </div>
          </div>

          <div className="section">
            <div className="section-title-row">
              <div className="section-title">
                {editingId
                  ? "Editar evento existente"
                  : "Novo evento (com empresa & observação)"}
              </div>
              <div className="section-helper">
                Campos mínimos: data, título, valor.
              </div>
            </div>
            <form className="form" onSubmit={handleSubmit}>
              <div className="form-row">
                <div className="form-field">
                  <label className="form-label">Data</label>
                  <input
                    type="date"
                    className="form-input"
                    value={form.data}
                    onChange={(e) => handleChange("data", e.target.value)}
                  />
                </div>
                <div className="form-field">
                  <label className="form-label">Título do evento</label>
                  <input
                    className="form-input"
                    placeholder="Pré evento, formatura..."
                    value={form.titulo}
                    onChange={(e) => handleChange("titulo", e.target.value)}
                  />
                </div>
              </div>

              <div className="form-row">
                <div className="form-field">
                  <label className="form-label">Empresa / cliente</label>
                  <input
                    className="form-input"
                    placeholder="Euphoria, escola, família..."
                    value={form.empresa}
                    onChange={(e) => handleChange("empresa", e.target.value)}
                  />
                </div>
                <div className="form-field">
                  <label className="form-label">Valor total (R$)</label>
                  <input
                    className="form-input"
                    type="number"
                    min="0"
                    step="0.01"
                    value={form.valor}
                    onChange={(e) => handleChange("valor", e.target.value)}
                  />
                </div>
              </div>

              <div className="form-row">
                <div className="form-field">
                  <label className="form-label">Forma de pagamento</label>
                  <select
                    className="form-select"
                    value={form.forma}
                    onChange={(e) => handleChange("forma", e.target.value)}
                  >
                    <option>Pix</option>
                    <option>Crédito</option>
                    <option>Débito</option>
                    <option>Dinheiro</option>
                    <option>Outro</option>
                  </select>
                </div>
                <div className="form-field">
                  <label className="form-label">Observação</label>
                  <input
                    className="form-input"
                    placeholder="Entrada, restante na data, etc."
                    value={form.observacao}
                    onChange={(e) =>
                      handleChange("observacao", e.target.value)
                    }
                  />
                </div>
              </div>

              <div className="form-footer">
                <div className="small-hint">
                  {editingId
                    ? "Editando um evento já cadastrado. Para cancelar, limpe os campos ou clique em outro evento."
                    : "Depois de salvo, use o status + valor parcial para controlar a evolução do pagamento."}
                </div>
                <div style={{ display: "flex", gap: 8 }}>
                  {editingId && (
                    <button
                      type="button"
                      className="btn-outline"
                      onClick={resetForm}
                    >
                      Cancelar edição
                    </button>
                  )}
                  <button type="submit" className="btn-primary">
                    {editingId ? "Salvar edição" : "Salvar evento"}
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      );
    }
        /* DÍVIDAS – agora com EDITAR e APAGAR, sem alterar layout */
    function DividasSection({
      debts,
      setDebts,
      debtMonth,
      setDebtMonth,
    }) {
      const today = new Date();
      const ym = `${today.getFullYear()}-${pad2(today.getMonth() + 1)}`;

      const [form, setForm] = useState({
        mesInicial: ym,
        conta: "",
        valorTotal: "",
        parcelas: "1",
        observacao: "",
      });

      const [editingGroup, setEditingGroup] = useState(null);

      const monthKey =
        debtMonth.year + "-" + pad2(debtMonth.month + 1);

      const debtsThisMonth = debts.filter(
        (d) => d.mesReferencia === monthKey
      );

      const totals = useMemo(() => {
        let total = 0;
        let pago = 0;
        debtsThisMonth.forEach((d) => {
          total += d.valorParcela || 0;
          if (d.status === "pago") pago += d.valorParcela || 0;
          if (d.status === "parcial") pago += d.valorPagoParcial || 0;
        });
        return { total, pago };
      }, [debtsThisMonth]);

      const handleChange = (field, value) => {
        setForm((f) => ({ ...f, [field]: value }));
      };

      const resetForm = () => {
        setForm({
          mesInicial: ym,
          conta: "",
          valorTotal: "",
          parcelas: "1",
          observacao: "",
        });
        setEditingGroup(null);
      };

      /* SALVAR OU EDITAR DÍVIDA */
      const handleSubmit = (e) => {
        e.preventDefault();
        const valorTotal = parseFloat(
          form.valorTotal.replace(",", ".")
        );
        const parcelas = parseInt(form.parcelas, 10) || 1;
        if (!form.mesInicial || !form.conta || !(valorTotal > 0)) return;

        const [y, m] = form.mesInicial.split("-");
        const startYear = parseInt(y, 10);
        const startMonth = parseInt(m, 10) - 1;
        const valorParcela =
          parcelas > 1 ? valorTotal / parcelas : valorTotal;

        if (editingGroup) {
          // EDITAR GRUPO EXISTENTE
          setDebts((prev) =>
            prev.map((d) => {
              if (d.grupoId !== editingGroup) return d;

              const index = d.id.split("-").pop();
              const { year, month } = addMonths(
                startYear,
                startMonth,
                parseInt(index, 10)
              );
              const novoMes = year + "-" + pad2(month + 1);

              return {
                ...d,
                conta: form.conta,
                observacao: form.observacao,
                valorParcela,
                mesReferencia: novoMes,
              };
            })
          );

          resetForm();
          return;
        }

        // CRIAR NOVAS PARCELAS
        const createdAt = Date.now();
        const grupoId = "g-" + createdAt.toString();

        const novos = [];
        for (let i = 0; i < parcelas; i++) {
          const { year, month } = addMonths(
            startYear,
            startMonth,
            i
          );
          const mesReferencia =
            year + "-" + pad2(month + 1);

          novos.push({
            id: `${grupoId}-${i}`,
            createdAt: createdAt + i,
            grupoId,
            conta: form.conta,
            mesReferencia,
            valorParcela,
            status: "pendente",
            valorPagoParcial: 0,
            observacao: form.observacao || "",
          });
        }

        setDebts((prev) => [...prev, ...novos]);

        resetForm();
      };

      const handleToggleStatus = (id) => {
        setDebts((prev) =>
          prev.map((d) =>
            d.id === id ? { ...d, status: cycleStatus(d.status) } : d
          )
        );
      };

      const handlePartialChange = (id, value) => {
        const n = parseFloat(value.replace(",", ".")) || 0;
        setDebts((prev) =>
          prev.map((d) =>
            d.id === id ? { ...d, valorPagoParcial: n } : d
          )
        );
      };

      const handlePrevMonth = () =>
        setDebtMonth((m) => addMonths(m.year, m.month, -1));
      const handleNextMonth = () =>
        setDebtMonth((m) => addMonths(m.year, m.month, 1));

      /* EDITAR DÍVIDA */
      const handleEditDebt = (grupoId) => {
        const grupo = debts.filter((d) => d.grupoId === grupoId);
        if (grupo.length === 0) return;

        const base = grupo[0];

        const parcelas = grupo.length;
        const mesInicial = grupo[0].mesReferencia;

        setEditingGroup(grupoId);
        setForm({
          mesInicial,
          conta: base.conta,
          valorTotal: String(base.valorParcela * parcelas),
          parcelas: String(parcelas),
          observacao: base.observacao,
        });
      };

      /* APAGAR DÍVIDA */
      const handleDeleteDebt = (grupoId) => {
        if (
          !window.confirm(
            "Tem certeza que deseja apagar TODAS as parcelas desta dívida?"
          )
        )
          return;

        setDebts((prev) => prev.filter((d) => d.grupoId !== grupoId));

        if (editingGroup === grupoId) resetForm();
      };

      return (
        <div className="card">
          <div className="card-header-row">
            <div>
              <div className="card-title">Dívidas / contas</div>
              <div className="card-subtitle">
                Conta, valor, pago parcial e parcelas distribuídas por meses.
              </div>
            </div>
          </div>

          <div className="section">
            <div className="section-title-row">
              <div className="section-title">
                Mês de referência –{" "}
                {monthLabel(debtMonth.year, debtMonth.month)}
              </div>
              <div className="calendar-nav">
                <button className="icon-btn" onClick={handlePrevMonth}>
                  ‹
                </button>
                <button className="icon-btn" onClick={handleNextMonth}>
                  ›
                </button>
              </div>
            </div>

            <div className="card-kpi-row" style={{ marginBottom: 8 }}>
              <div className="kpi-card">
                <div className="kpi-label">
                  Total deste mês (todas parcelas)
                </div>
                <div className="kpi-main negative">
                  {money(totals.total)}
                </div>
              </div>
              <div className="kpi-card">
                <div className="kpi-label">Já pago neste mês</div>
                <div className="kpi-main positive">
                  {money(totals.pago)}
                </div>
              </div>
            </div>

            <div className="list">
              {debtsThisMonth.length === 0 && (
                <div
                  className="small-hint"
                  style={{ paddingInline: 4, color: "var(--text-muted)" }}
                >
                  Nenhuma conta cadastrada para este mês.
                </div>
              )}
              {debtsThisMonth
                .slice()
                .sort((a, b) => a.createdAt - b.createdAt)
                .map((d) => (
                  <div key={d.id} className="list-item">
                    <div className="list-item-main-row">
                      <div>
                        <div className="list-item-title">
                          {d.conta || "Conta"}
                        </div>
                        <div className="list-item-sub">
                          Parcela de {money(d.valorParcela)} ·{" "}
                          {d.mesReferencia}
                        </div>
                      </div>

                      <div style={{ textAlign: "right" }}>
                        <div className="chip-amount-negative">
                          {money(d.valorParcela)}
                        </div>
                        <StatusPill status={d.status} />
                      </div>
                    </div>

                    <div className="list-item-actions-row">
                      <div style={{ display: "flex", flexDirection: "column", gap: 3 }}>
                        <span className="label-tag">Valor já pago (R$)</span>
                        <input
                          className="form-input"
                          style={{
                            maxWidth: 130,
                            fontSize: 11,
                            padding: "4px 6px",
                          }}
                          type="number"
                          min="0"
                          step="0.01"
                          value={
                            d.valorPagoParcial === 0 ||
                            d.valorPagoParcial
                              ? d.valorPagoParcial
                              : ""
                          }
                          onChange={(e) =>
                            handlePartialChange(d.id, e.target.value)
                          }
                        />
                      </div>

                      <div style={{ display: "flex", gap: 8 }}>
                        <button
                          className="edit-btn"
                          type="button"
                          onClick={() => handleEditDebt(d.grupoId)}
                        >
                          Editar
                        </button>

                        <button
                          className="delete-btn"
                          type="button"
                          onClick={() => handleDeleteDebt(d.grupoId)}
                        >
                          Apagar
                        </button>

                        <button
                          className="btn-ghost"
                          type="button"
                          onClick={() => handleToggleStatus(d.id)}
                        >
                          Girar status
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
            </div>
          </div>

          <div className="section">
            <div className="section-title-row">
              <div className="section-title">
                {editingGroup
                  ? "Editar dívida parcelada"
                  : "Nova dívida / conta parcelada"}
              </div>
              <div className="section-helper">
                Preencha conta, valor total e parcelas.
              </div>
            </div>

            <form className="form" onSubmit={handleSubmit}>
              <div className="form-row">
                <div className="form-field">
                  <label className="form-label">Mês inicial</label>
                  <input
                    type="month"
                    className="form-input"
                    value={form.mesInicial}
                    onChange={(e) =>
                      handleChange("mesInicial", e.target.value)
                    }
                  />
                </div>
                <div className="form-field">
                  <label className="form-label">Conta / descrição</label>
                  <input
                    className="form-input"
                    placeholder="Cartão Nubank, câmera..."
                    value={form.conta}
                    onChange={(e) =>
                      handleChange("conta", e.target.value)
                    }
                  />
                </div>
              </div>

              <div className="form-row">
                <div className="form-field">
                  <label className="form-label">Valor total (R$)</label>
                  <input
                    className="form-input"
                    type="number"
                    min="0"
                    step="0.01"
                    value={form.valorTotal}
                    onChange={(e) =>
                      handleChange("valorTotal", e.target.value)
                    }
                  />
                </div>
                <div className="form-field">
                  <label className="form-label">Nº de parcelas</label>
                  <input
                    className="form-input"
                    type="number"
                    min="1"
                    step="1"
                    value={form.parcelas}
                    onChange={(e) =>
                      handleChange("parcelas", e.target.value)
                    }
                  />
                </div>
              </div>

              <div className="form-row">
                <div className="form-field">
                  <label className="form-label">Observação</label>
                  <textarea
                    className="form-textarea"
                    placeholder="Acordo, renegociação..."
                    value={form.observacao}
                    onChange={(e) =>
                      handleChange("observacao", e.target.value)
                    }
                  />
                </div>
              </div>

              <div className="form-footer">
                <div className="small-hint">
                  Parcelas são distribuídas automaticamente pelos meses.
                </div>

                <div style={{ display: "flex", gap: 8 }}>
                  {editingGroup && (
                    <button
                      type="button"
                      className="btn-outline"
                      onClick={resetForm}
                    >
                      Cancelar edição
                    </button>
                  )}
                  <button type="submit" className="btn-primary">
                    {editingGroup ? "Salvar edição" : "Salvar dívida"}
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      );
    }
        /* APP RAIZ */

    function App() {
      const saved = useMemo(() => {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return null;
          return JSON.parse(raw);
        } catch {
          return null;
        }
      }, []);

      const today = new Date();

      const [events, setEvents] = useState(() => saved?.events || []);
      const [debts, setDebts] = useState(() => saved?.debts || []);
      const [theme, setTheme] = useState(() => saved?.theme || "light");
      const [activeTab, setActiveTab] = useState("dashboard");

      const [eventMonth, setEventMonth] = useState(() => ({
        year: today.getFullYear(),
        month: today.getMonth(),
      }));

      const [debtMonth, setDebtMonth] = useState(() => ({
        year: today.getFullYear(),
        month: today.getMonth(),
      }));

      useEffect(() => {
        document.body.classList.remove("light", "dark");
        document.body.classList.add(theme);
      }, [theme]);

      useEffect(() => {
        try {
          localStorage.setItem(
            STORAGE_KEY,
            JSON.stringify({ events, debts, theme })
          );
        } catch {
          // se o navegador não deixar salvar, paciência
        }
      }, [events, debts, theme]);

      const handleToggleTheme = () => {
        setTheme((t) => (t === "light" ? "dark" : "light"));
      };

      /* PDF geral (print da tela) – mantém layout que você já curte */
      const handleExportPDF = async () => {
        try {
          const root = document.getElementById("root");
          if (!root) return;

          const canvas = await html2canvas(root, {
            scale: 2,
            backgroundColor: theme === "dark" ? "#020617" : "#f3f4f6",
          });

          const imgData = canvas.toDataURL("image/png");
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF("p", "mm", "a4");
          const pageWidth = pdf.internal.pageSize.getWidth();
          const pageHeight = pdf.internal.pageSize.getHeight();

          const ratio = Math.min(
            pageWidth / canvas.width,
            pageHeight / canvas.height
          );
          const imgWidth = canvas.width * ratio;
          const imgHeight = canvas.height * ratio;

          const x = (pageWidth - imgWidth) / 2;
          const y = 8;

          pdf.addImage(imgData, "PNG", x, y, imgWidth, imgHeight);
          pdf.save("painel-financeiro-prestes.pdf");
        } catch (err) {
          console.error(err);
          alert(
            "Não consegui gerar o PDF agora. Tenta recarregar a página e gerar de novo."
          );
        }
      };

      return (
        <div className="app-shell">
          <header className="app-header">
            <div className="app-title">
              <div className="pill-badge">
                <span className="pill-dot" />
                PAINEL FINANCEIRO · PRESTES
              </div>
              <h1>Eventos, dívidas e parcelas em modo profissional</h1>
              <p>
                Uma tela pra cada lado da sua mente: dashboard, calendário de
                eventos e matriz de dívidas. Tudo salvo no seu navegador.
              </p>
            </div>

            <div className="header-right">
              <div className="theme-toggle" onClick={handleToggleTheme}>
                <div className="theme-toggle-indicator">
                  <div className="theme-toggle-indicator-inner" />
                </div>
                <span>{theme === "dark" ? "Escuro" : "Claro"}</span>
              </div>
              <div className="storage-note">
                Dados guardados apenas no seu navegador (localStorage). Se
                limpar o histórico, adeus tudo.
              </div>
            </div>
          </header>

          <div className="tabs-row">
            <button
              className={
                "tab-btn" + (activeTab === "dashboard" ? " active" : "")
              }
              onClick={() => setActiveTab("dashboard")}
            >
              Dashboard
            </button>
            <button
              className={
                "tab-btn" + (activeTab === "eventos" ? " active" : "")
              }
              onClick={() => setActiveTab("eventos")}
            >
              Eventos
            </button>
            <button
              className={
                "tab-btn" + (activeTab === "dividas" ? " active" : "")
              }
              onClick={() => setActiveTab("dividas")}
            >
              Dívidas
            </button>
          </div>

          {activeTab === "dashboard" && (
            <Dashboard
              events={events}
              debts={debts}
              onExportPDF={handleExportPDF}
            />
          )}

          {activeTab === "eventos" && (
            <EventosSection
              events={events}
              setEvents={setEvents}
              eventMonth={eventMonth}
              setEventMonth={setEventMonth}
            />
          )}

          {activeTab === "dividas" && (
            <DividasSection
              debts={debts}
              setDebts={setDebts}
              debtMonth={debtMonth}
              setDebtMonth={setDebtMonth}
            />
          )}
        </div>
      );
    }

    /* MONTAGEM NO DOM */
    const rootEl = document.getElementById("root");
    ReactDOM.createRoot(rootEl).render(<App />);
    .edit-btn, .delete-btn {
  padding: 4px 8px;
  border-radius: 8px;
  font-size: 10px;
  cursor: pointer;
  border: none;
  transition: 0.15s ease-out;
}

.edit-btn {
  background: #3b82f6;
  color: white;
}

.edit-btn:hover {
  filter: brightness(1.1);
}

.delete-btn {
  background: #ef4444;
  color: white;
}

.delete-btn:hover {
  filter: brightness(
